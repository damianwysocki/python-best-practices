---
title: Use Alembic with Autogenerate and Review Every Migration
impact: MEDIUM
impactDescription: Ensures safe schema evolution
tags: migration, alembic, autogenerate, schema, review
---

## Use Alembic with Autogenerate and Review Every Migration

Alembic's `--autogenerate` compares your models against the database and
generates migration scripts. However, autogenerate does not detect everything
(renamed columns, data type changes on some backends, CHECK constraints).
Always review and edit the generated migration before applying it.

**Incorrect (applying autogenerated migration without review):**

```python
# alembic revision --autogenerate -m "add users"
# alembic upgrade head  # Applied blindly

# Generated migration might miss:
# - Column renames (shows as drop + add, losing data)
# - Server defaults
# - Partial indexes
```

**Correct (review and adjust autogenerated migration):**

```python
# Step 1: Generate
# alembic revision --autogenerate -m "add users table"

# Step 2: Review the generated file
def upgrade() -> None:
    op.create_table(
        "users",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("name", sa.String(100), nullable=False),
        sa.Column("email", sa.String(255), nullable=False),
        sa.Column("created_at", sa.DateTime(), server_default=sa.func.now()),
        sa.PrimaryKeyConstraint("id", name=op.f("pk_users")),
        sa.UniqueConstraint("email", name=op.f("uq_users_email")),
    )
    op.create_index(op.f("ix_users_email"), "users", ["email"])

def downgrade() -> None:
    op.drop_index(op.f("ix_users_email"), table_name="users")
    op.drop_table("users")
```

Configure `env.py` to import your `Base.metadata` so autogenerate can
compare models to the database. Set `compare_type=True` to detect column
type changes.

Reference: https://alembic.sqlalchemy.org/en/latest/autogenerate.html
